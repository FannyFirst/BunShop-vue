(function(t){function e(e){for(var i,o,s=e[0],c=e[1],u=e[2],d=0,f=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);l&&l(e);while(f.length)f.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={app:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("85ec"),r=n.n(i);r.a},"0721":function(t,e,n){"use strict";var i=n("6e9d"),r=n.n(i);r.a},"359c":function(t,e,n){},"3ce6":function(t,e,n){"use strict";var i=n("495f"),r=n.n(i);r.a},"495f":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("transition",{attrs:{name:"slide-fade"}},[n("router-view")],1)],1)},a=[],o={name:"App",beforeCreate:function(){this.$cookies.config("30d")}},s=o,c=(n("034f"),n("2877")),u=Object(c["a"])(s,r,a,!1,null,null,null),l=u.exports,d=n("b970"),f=(n("157a"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"margin-bottom":"60px"}},[i("van-nav-bar",{staticStyle:{height:"60px"},attrs:{fixed:""},scopedSlots:t._u([{key:"title",fn:function(){return[i("div",{staticStyle:{"font-size":"20px",display:"flex"}},[i("van-image",{attrs:{height:"30px",width:"30px",src:n("b5e9")}}),i("b",[t._v("包 子 铺")])],1)]},proxy:!0}])}),0===t.active?i("BunsList"):i("History"),i("van-tabbar",{model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[i("van-tabbar-item",{attrs:{icon:"home-o"}},[t._v("主页")]),i("van-tabbar-item",{attrs:{icon:"user-o"}},[t._v("我的")])],1)],1)}),m=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-row",[i("van-col",{attrs:{span:"5"}},[i("van-sidebar",{on:{change:t.onChange},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},t._l(t.list,(function(t,e){return i("div",{key:e},[i("van-sidebar-item",{attrs:{title:t.name}})],1)})),0)],1),i("van-col",{attrs:{span:"19"}},[i("div",t._l(t.buns,(function(e){return i("van-card",{key:e.id,attrs:{num:e.num,price:e.price,title:e.name,desc:"有"+e.num+"个"+e.name+"等你来买哦",thumb:n(0===e.pic_url?"a18b":"bc70")},scopedSlots:t._u([{key:"footer",fn:function(){return[i("van-stepper",{attrs:{min:"0",max:e.num},model:{value:e.selectedNum,callback:function(n){t.$set(e,"selectedNum",n)},expression:"item.selectedNum"}})]},proxy:!0}],null,!0)})})),1)])],1),i("van-button",{staticClass:"cart",attrs:{icon:"cart-o",round:"",type:"info",color:"linear-gradient(to right, rgb(244, 197, 110), rgb(233, 32, 32))"},on:{click:t.cartHandler}}),i("van-popup",{style:{max_height:"60%",paddingBottom:"50px"},attrs:{round:"",position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._l(t.cart,(function(e){return i("van-card",{key:e.name,attrs:{num:e.selectedNum,price:e.price,desc:"这"+e.selectedNum+"个"+e.name+"等你来买呢",title:e.name,thumb:n(0===e.pic_url?"a18b":"bc70")},scopedSlots:t._u([{key:"footer",fn:function(){return[i("van-stepper",{attrs:{min:"0",max:e.num},on:{plus:function(n){t.totalPrice+=100*e.price},minus:function(n){t.totalPrice-=100*e.price}},model:{value:e.selectedNum,callback:function(n){t.$set(e,"selectedNum",n)},expression:"item.selectedNum"}})]},proxy:!0}],null,!0)})})),i("van-submit-bar",{attrs:{price:t.totalPrice,"button-text":"支付"},on:{submit:t.onSubmit}})],2),i("van-overlay",{staticClass:"wrapper",attrs:{show:t.showNumCard},on:{click:t.stopNotify}},[i("div",{staticClass:"block wrapper",on:{click:function(t){t.stopPropagation()}}},[i("div",[t._v(t._s(t.noting?"取包子":"您的包子号是")),i("br"),i("span",{staticClass:"queueIndex"},[t._v(" "+t._s(t.bunsNum)+" ")]),i("br"),i("div",[i("van-switch",{attrs:{"active-color":"#07c160",size:"24px"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),i("div",[t._v("开启震动通知")])],1)])])])],1)},h=[],v=(n("4de4"),n("4160"),n("d81d"),n("13d5"),n("159b"),n("d3b7"),n("bc3a")),b=n.n(v),g="http://192.168.0.104:5000/",y=b.a.create({baseURL:g});y.interceptors.request.use((function(t){return t})),y.interceptors.response.use((function(t){return t.data}));var _=y,x={userList:"/user",userLogin:"/user/login",bunsList:"/buns/",orderList:"/order",buy:"/buy/",buyingList:"/buy/buying"},k=function(t){var e=t.url,n=t.params,i=void 0===n?void 0:n,r=t.method,a=void 0===r?"GET":r,o=t.data,s=void 0===o?void 0:o;return new Promise((function(t,n){_({url:e,method:a,params:i,data:s}).then((function(e){t(e)})).catch((function(t){n(t)}))}))};function w(){return k({url:x.userList})}function O(){return k({url:x.orderList})}function L(t){return k({url:x.orderList+"/"+t})}function N(){return k({url:x.bunsList})}function j(t){return k({url:x.bunsList,params:t,method:"POST"})}function S(t){return k({url:x.bunsList+t,method:"DELETE"})}function P(t){return k({url:x.userLogin,params:{id:t},method:"POST"})}function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{id:-1,num:0}],e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return k({url:x.buy,data:{cart:t,uid:e,totalPrice:n},method:"POST"})}function C(t){return k({url:x.buy,params:{id:t}})}function B(){return k({url:x.buyingList})}function I(t){return k({url:x.buyingList+"/"+t})}function E(t){return k({url:x.buyingList,params:{id:t},method:"POST"})}var A=n("2241"),M=n("d399"),D={name:"BunsList",watch:{note:function(){this.stopNotify()}},data:function(){return{activeKey:0,show:!1,showNumCard:!1,list:[{name:"所有包子"},{name:"菜包子"},{name:"肉包子"}],buns:[],cart:[],totalPrice:0,note:!0,vibrate:void 0,asking:void 0,noting:!1,bunsNum:0,needReload:!1}},methods:{onLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;N().then((function(n){n.data=n.data.map((function(t){return t["selectedNum"]=0,t})),t.buns=-1===e?n.data:0===e?n.data.filter((function(t){return 0===t.pic_url})):n.data.filter((function(t){return 1===t.pic_url}))}))},onChange:function(t){this.onLoad(t-1)},onSubmit:function(){var t=this;this.cart.length&&A["a"].alert({title:"示例支付",message:"未实际调用支付接口，仅仅作为示例，接下来你可以拿到你的取餐号了！"}).then((function(){var e=[];t.cart.forEach((function(t){e.push({index:t.index,num:t.selectedNum})})),"undefined"===typeof t.asking&&($(e,t.$cookies.get("uid"),t.totalPrice).then((function(e){1e4===e.code?(t.bunsNum=e.data+1,t.setAsking(e.data),t.showNumCard=!0,t.show=!1):3e4===e.code?Object(M["a"])("包子卖完了呢"):Object(M["a"])("购买失败"),console.log(e)})),t.onLoad(t.activeKey-1))}))},cartHandler:function(){var t=this;"undefined"!==typeof this.asking?(Object(M["a"])("你的这个订单没有完成！不可以购买"),this.show=!1,this.showNumCard=!0):(this.totalPrice=0,this.cart=[],this.buns.reduce((function(e,n,i){return n["selectedNum"]>0&&(e.push(Object.assign(n,{index:i})),t.totalPrice+=n.price*n.selectedNum),e}),this.cart),this.totalPrice*=100,this.cart.length<=0?Object(M["a"])("选一点包子再买嘛！"):this.show=!this.show)},setAsking:function(t){var e=this;this.asking=setInterval((function(){C(t).then((function(t){console.log(t),1e4===t.code?(e.notifyUser(),clearInterval(e.asking),e.needReload=!0):40001!==t.code&&console.error("业务逻辑有问题！！")}))}),3e3)},notifyUser:function(){this.noting=!0,this.showNumCard=!0,this.show=!1,this.note&&(window.navigator.vibrate?this.vibrate=setInterval((function(){window.navigator.vibrate(500)}),1e3):console.error("此设备不支持震动！！"))},stopNotify:function(){this.showNumCard=!1,clearInterval(this.vibrate),this.needReload&&Object.assign(this.$data,this.$options.data()),this.onLoad()},checkBuying:function(){var t=this;I(this.$cookies.get("uid")).then((function(e){1e4===e.code?t.bunsNum=-1:40002===e.code&&(t.bunsNum=e.data+1,t.setAsking(e.data),t.showNumCard=!0)}))}},created:function(){this.onLoad(),this.checkBuying()}},H=D,q=(n("0721"),Object(c["a"])(H,p,h,!1,null,"8c83fc8a",null)),T=q.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._l(t.list,(function(e){return i("div",{key:e.start},[t._l(e.buns,(function(t,e){return i("van-card",{key:e,attrs:{num:t.num,price:t.price,title:t.name,desc:"买了"+t.num+"个"+t.name+"哦",thumb:n(0===t.pic_url?"a18b":"bc70")}})})),i("van-divider",[t._v(t._s(t.dateFormat(e["created_at"]))+" 消费￥"+t._s(e["money"]/100))])],2)})),0)},z=[],K={name:"History",data:function(){return{list:[],error:!0,loading:!1}},methods:{onLoad:function(){var t=this;L(this.$cookies.get("uid")).then((function(e){console.log(e),t.list=e.data}))},dateFormat:function(t){var e=new Date(1e3*parseInt(t)),n=e.getMonth()+1;return n+="/"+e.getDate(),n+=" "+e.getHours(),n+=":"+e.getMinutes(),n}},created:function(){this.onLoad()}},F=K,U=Object(c["a"])(F,R,z,!1,null,"c815bbfc",null),J=U.exports,G={name:"index",data:function(){return{active:0}},methods:{},components:{BunsList:T,History:J},beforeCreate:function(){var t=this;P(this.$cookies.get("uid")).then((function(e){console.log(e),t.$cookies.set("uid",e.data)})),Notification.requestPermission((function(t){console.log("用户是否允许通知： ","granted"===t?"允许":"拒绝")})),Notification.requestPermission().then((function(t){console.log("用户是否允许通知： ","granted"===t?"允许":"拒绝")}))}},Q=G,V=Object(c["a"])(Q,f,m,!1,null,"a1f75390",null),W=V.exports,X=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-nav-bar",{staticStyle:{height:"60px"},attrs:{fixed:""},on:{"click-right":function(e){t.opening=!t.opening},"click-left":function(e){t.opening=0}},scopedSlots:t._u([t.opening&&0===t.active?{key:"left",fn:function(){return[i("transition",{attrs:{name:"fade-s"}},[i("van-button",{attrs:{round:"",plain:"",type:"info",size:"small"}},[t._v(" 取消 ")])],1)]},proxy:!0}:null,{key:"title",fn:function(){return[i("div",{staticStyle:{"font-size":"20px",display:"flex"}},[i("van-image",{attrs:{height:"30px",width:"30px",src:n("b5e9")}}),i("b",[t._v("包 子 铺")])],1)]},proxy:!0},{key:"right",fn:function(){return[i("transition",{attrs:{name:"fade-s"}},[0===t.active?i("van-button",{attrs:{round:"",type:"info",size:"small",color:t.opening?"linear-gradient(to right, #1DDA7B, #1DDAA1)":"linear-gradient(to right, #4bb0ff, #6149f6)"}},[t._v(" "+t._s(t.opening?"完成":"添加")+" ")]):t._e()],1)]},proxy:!0}],null,!0)}),i("div",{staticClass:"content"},[0===t.active?i("div",[i("transition",{attrs:{name:"fade"}},[i("AddBuns",{directives:[{name:"show",rawName:"v-show",value:t.opening,expression:"opening"}],attrs:{finished:t.opening}})],1),i("BunsList_m",{attrs:{refreshHook:t.opening}})],1):1===t.active?i("div",[i("Cart")],1):i("div",[i("Manage")],1)]),i("van-tabbar",{model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[i("van-tabbar-item",{attrs:{icon:"shop-o"}},[t._v("商家")]),i("van-tabbar-item",{attrs:{icon:"shopping-cart-o"}},[t._v("购买")]),i("van-tabbar-item",{attrs:{icon:"manager-o"}},[t._v("管理")])],1)],1)},Y=[],Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-cell-group",[n("van-field",{attrs:{label:"名称",placeholder:"输入包子名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("van-cell",{staticStyle:{"text-align":"left"},attrs:{center:"",title:"是否肉包子"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[n("van-switch",{attrs:{size:"24"},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}})]},proxy:!0}])}),n("van-field",{attrs:{formatter:t.formatter,type:"number",label:"单价"},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}}),n("van-cell",{staticStyle:{"text-align":"left"},attrs:{center:"",title:"包子数量"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[n("van-stepper",{attrs:{integer:"",min:"1",max:"999"},model:{value:t.num,callback:function(e){t.num=e},expression:"num"}})]},proxy:!0}])})],1)],1)},tt=[],et=(n("b0c0"),n("a9e3"),n("ac1f"),n("25f0"),n("466d"),{name:"AddBuns",props:["finished"],watch:{finished:function(t){var e=this;!1===t&&this.checkInput()&&j({name:this.name,price:this.price,type:this.checked?1:null,num:this.num}).then((function(){Object(M["a"])("添加成功"),Object.assign(e.$data,e.$options.data())}))}},data:function(){return{checked:!1,price:0,name:"",num:1}},methods:{formatter:function(t){if("."!==t[t.length-1]&&Number(t).toString().length!==t.length)return Number(t);var e=t.match(/(\d+\.?\d{0,2})/);return e?e[0]:null},checkInput:function(){return this.price<=0?(Object(M["a"])("价格不能为0"),!1):!(null===this.name||this.name.length<1)||(Object(M["a"])("名称不能为空"),!1)}}}),nt=et,it=Object(c["a"])(nt,Z,tt,!1,null,"38755e9f",null),rt=it.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-list",{attrs:{error:t.error,"error-text":"没有更多了~"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e,r){return i("van-swipe-cell",{key:e.id,scopedSlots:t._u([{key:"right",fn:function(){return[i("van-button",{staticClass:"side_button",attrs:{square:"",type:"danger",text:"删除"},on:{click:function(n){return t.delBun(e.name,r)}}})]},proxy:!0}],null,!0)},[i("van-card",{attrs:{num:e.num,price:e.price,title:e.name,desc:"有"+e.num+"个"+e.name+"等你来买哦",thumb:n(0===e.pic_url?"a18b":"bc70")}})],1)})),1)],1)},ot=[],st={name:"BunsList_m",props:["refreshHook"],watch:{refreshHook:function(t){t||this.onLoad()}},data:function(){return{list:[{pic_url:1,name:"",price:1,num:1}],error:!0,loading:!1}},methods:{onLoad:function(){var t=this;N().then((function(e){t.list=e.data,t.loading=!1,t.error=!0}))},delBun:function(t,e){var n=this;A["a"].confirm({title:"确认删除？",message:"将删除"+t}).then((function(){S(e).then((function(t){console.log(e,t),t?Object(M["a"])("删除成功！"):Object(M["a"])("删除失败！"),n.onLoad()}))})).catch((function(){}))}},created:function(){var t=this;N().then((function(e){t.list=e.data}))}},ct=st,ut=(n("d21c"),Object(c["a"])(ct,at,ot,!1,null,"77ba78b8",null)),lt=ut.exports,dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",t._l(t.list,(function(e,r){return i("van-swipe-cell",{key:e.start,scopedSlots:t._u([{key:"right",fn:function(){return[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!e["ready"],expression:"!item['ready']"}],staticClass:"primary-button",attrs:{square:"",text:"完成",type:"primary"},on:{click:function(e){return t.confirm(r)}}})]},proxy:!0}],null,!0)},[i("van-divider",{directives:[{name:"show",rawName:"v-show",value:!e["ready"],expression:"!item['ready']"}]},[t._v("用户"+t._s(e.uid))]),t._l(e.buns,(function(t,r){return i("van-card",{directives:[{name:"show",rawName:"v-show",value:!e["ready"],expression:"!item['ready']"}],key:r,attrs:{num:t.num,price:t.price,title:t.name,desc:"有"+t.num+"个"+t.name+"等你来买哦",thumb:n(0===t.pic_url?"a18b":"bc70")}})}))],2)})),1)},ft=[],mt={name:"Cart",data:function(){return{list:[],rollRequest:void 0}},methods:{confirm:function(t){E(t).then((function(t){1e4===t.code&&Object(M["a"])("确认成功！")}))},refreshList:function(){var t=this;B().then((function(e){t.list=e}))},startInterval:function(){var t=this;this.rollRequest=setInterval((function(){t.refreshList()}),1e3)},stopInterval:function(){clearInterval(this.rollRequest)}},created:function(){this.startInterval()},beforeDestroy:function(){this.stopInterval()}},pt=mt,ht=(n("d1d8"),Object(c["a"])(pt,dt,ft,!1,null,"7b7e474f",null)),vt=ht.exports,bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-grid",{attrs:{"column-num":3}},[i("van-grid-item",{attrs:{icon:"user-o",text:"用户数："+t.users.length}}),i("van-grid-item",{attrs:{icon:"cash-on-deliver",text:"总收入："+t.totalAmount/100}}),i("van-grid-item",{attrs:{icon:"completed",text:"完成交易："+t.list.length}})],1),t._l(t.list,(function(e){return i("div",{key:e.start},[t._l(e.buns,(function(t,e){return i("van-card",{key:e,attrs:{num:t.num,price:t.price,title:t.name,desc:"买了"+t.num+"个"+t.name+"哦",thumb:n(0===t.pic_url?"a18b":"bc70")}})})),i("van-divider",[t._v(" 收入￥"+t._s(e["money"]/100))])],2)}))],2)},gt=[],yt={name:"Manage",data:function(){return{list:[],totalAmount:0,users:[]}},methods:{dateFormat:function(t){var e=new Date(1e3*parseInt(t)),n=e.getMonth()+1;return n+="/"+e.getDate(),n+=" "+e.getHours(),n+=":"+e.getMinutes(),n}},created:function(){var t=this;w().then((function(e){t.users=e.data})),O().then((function(e){t.list=e.data,t.totalAmount=t.list.reduce((function(t,e){return t+e["money"]}),0)}))}},_t=yt,xt=Object(c["a"])(_t,bt,gt,!1,null,"16bb8820",null),kt=xt.exports,wt={name:"index",data:function(){return{active:0,opening:!1}},methods:{},created:function(){console.log(11111111111)},components:{AddBuns:rt,BunsList_m:lt,Cart:vt,Manage:kt}},Ot=wt,Lt=(n("3ce6"),Object(c["a"])(Ot,X,Y,!1,null,"2b623668",null)),Nt=Lt.exports,jt=n("8c4f");i["a"].use(jt["a"]);var St=[{path:"/",component:W,name:"index"},{path:"/m",component:Nt,name:"merchant"}],Pt=new jt["a"]({routes:St}),$t=n("2b27"),Ct=n.n($t);i["a"].config.productionTip=!1,i["a"].use(d["a"]),i["a"].use(Ct.a),new i["a"]({router:Pt,render:function(t){return t(l)}}).$mount("#app")},"6e9d":function(t,e,n){},"85ec":function(t,e,n){},a18b:function(t,e,n){t.exports=n.p+"img/v_buns.4032ae81.jpg"},a3fb:function(t,e,n){},b5e9:function(t,e,n){t.exports=n.p+"img/bun.d26b1c72.png"},bc70:function(t,e,n){t.exports=n.p+"img/m_buns.b7ab692e.jpg"},d1d8:function(t,e,n){"use strict";var i=n("a3fb"),r=n.n(i);r.a},d21c:function(t,e,n){"use strict";var i=n("359c"),r=n.n(i);r.a}});
//# sourceMappingURL=app.7f5ce20a.js.map